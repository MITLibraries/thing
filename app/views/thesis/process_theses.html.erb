<h3>Thesis Submissions Queue</h3>

<div class="wrap-filters">
  View:
  <%= link_to "All", process_path, { class: 'btn button-small button-secondary'} %>
  <%= link_to "Active", process_path(status: 'active'), { class: 'btn button-small button-secondary'} %>
  <%= link_to "Downloaded", process_path(status: 'downloaded'), { class: 'btn button-small button-secondary'} %>
  <%= link_to "Withdrawn", process_path(status: 'withdrawn'), { class: 'btn button-small button-secondary'} %>
</div>

<% @theses.each do |thesis| %>
  <div class="panel panel-<%= thesis.css_alert_type %>" data-id="thesis_<%= thesis.id %>">
    <div class="panel-heading">
      <div class="layout-3q1q layout-band">
        <div class="col3q">
          <%= thesis.user.email %>
        </div>
        <div class="col1q">
          <%= thesis.graduation_month %> <%= thesis.graduation_year %>
        </div>
      </div>
    </div>
    <div class="panel-body">
      <div class="layout-3q1q layout-band">
        <div class="col3q">
          <%= "Department".pluralize(thesis.departments.count) %>:
            <%= thesis.departments.map{|d| d.name}.join(",") %><br />
          <%= "Degree".pluralize(thesis.degrees.count) %>:
            <%= thesis.degrees.map{|d| d.name}.join(",") %><br />
          </div>
          <div class="col1q">
            <% if thesis.status == "active" %>
              <%= button_to "Mark as downloaded",
                  { action: "mark_downloaded", id: thesis.id },
                  remote: true %>
            <% end %>
          </div>
        </div>
    </div>
    <div class="panel-footer">
      <%= link_to "View details", thesis_path(thesis.id) %>
      --
      Status: <span class="text-<%= thesis.css_alert_type %>">
        <%= thesis.status %></span>
      <%# Other stuff should go here when e.g. people can mark as done or
          a download link exists. %>
    </div>
  </div>
<% end %>

<%= paginate @theses %>

<script>markDownloaded();</script>